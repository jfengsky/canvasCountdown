// Generated by CoffeeScript 1.6.3
(function() {
  var MARGIN_LEFT, MARGIN_TOP, RADIUS, SCREEN_HEIGHT, SCREEN_WIDTH, canvas, context, countDown, doc, fullTime, renderDigit, renderTime;
  SCREEN_WIDTH = 1024;
  SCREEN_HEIGHT = 768;
  MARGIN_TOP = 60;
  MARGIN_LEFT = 30;
  RADIUS = 8;
  doc = document;
  canvas = doc.getElementById('canvas');
  context = canvas.getContext('2d');
  canvas.width = SCREEN_WIDTH;
  canvas.height = SCREEN_HEIGHT;
  /*
   * 渲染字体
   * @param {Number}  x    球距离左侧距离 
   * @param {Number}  y    球距离顶部距离
   * @param {String}  num  要渲染的数字和符号
   * @param {Object}  ctx  画布对象
   * @return
  */

  renderDigit = function(_x, _y, _num, _ctx) {
    var _i, _index_i, _index_j, _item_i, _item_j, _j, _len, _len1, _ref, _ref1;
    _ctx.fillStyle = "rgb(0, 102, 153)";
    _ref = digit[_num];
    for (_item_i = _i = 0, _len = _ref.length; _i < _len; _item_i = ++_i) {
      _index_i = _ref[_item_i];
      _ref1 = digit[_num][_item_i];
      for (_item_j = _j = 0, _len1 = _ref1.length; _j < _len1; _item_j = ++_j) {
        _index_j = _ref1[_item_j];
        if (digit[_num][_item_i][_item_j] === 1) {
          _ctx.beginPath();
          _ctx.arc(_x + _item_j * 2 * (RADIUS + 1) + (RADIUS + 1), _y + _item_i * 2 * (RADIUS + 1) + (RADIUS + 1), RADIUS, 0, 2 * Math.PI);
          _ctx.closePath();
          _ctx.fill();
        }
      }
    }
  };
  /*
   * 渲染时间字体
   * @param {Object}  ctx  画布对象
   * @return
   *
  */

  renderTime = function(_Time, _ctx) {
    _ctx.clearRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
    renderDigit(MARGIN_LEFT, MARGIN_TOP, _Time.h[0] - 0, _ctx);
    renderDigit(MARGIN_LEFT + 15 * (RADIUS + 1), MARGIN_TOP, _Time.h[1] - 0, _ctx);
    renderDigit(MARGIN_LEFT + 30 * (RADIUS + 1), MARGIN_TOP, 10, _ctx);
    renderDigit(MARGIN_LEFT + 39 * (RADIUS + 1), MARGIN_TOP, _Time.m[0] - 0, _ctx);
    renderDigit(MARGIN_LEFT + 54 * (RADIUS + 1), MARGIN_TOP, _Time.m[1] - 0, _ctx);
    renderDigit(MARGIN_LEFT + 69 * (RADIUS + 1), MARGIN_TOP, 10, _ctx);
    renderDigit(MARGIN_LEFT + 78 * (RADIUS + 1), MARGIN_TOP, _Time.s[0] - 0, _ctx);
    renderDigit(MARGIN_LEFT + 93 * (RADIUS + 1), MARGIN_TOP, _Time.s[1] - 0, _ctx);
  };
  /*
   * 时间补0
   * @param {Number}  _time  时间数字
   * @return {String}        补0后的数字
  */

  fullTime = function(_time) {
    if (_time < 10) {
      return '0' + _time;
    } else {
      return _time + '';
    }
  };
  /*
   * 倒计时
  */

  countDown = function() {
    var countTime, endTime, startTime;
    startTime = new Date(2014, 7, 26, 23, 53).getTime();
    endTime = new Date(2014, 7, 27, 1, 10).getTime();
    countTime = endTime - startTime;
    setInterval(function() {
      var tempDate;
      if (countTime > 0) {
        tempDate = new Date(countTime);
        renderTime({
          h: fullTime(tempDate.getHours()),
          m: fullTime(tempDate.getMinutes()),
          s: fullTime(tempDate.getSeconds())
        }, context);
        return countTime = countTime - 1000;
      }
    }, 1000);
  };
  countDown();
})();
